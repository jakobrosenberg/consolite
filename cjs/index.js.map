{"version":3,"sources":["../esm/index.mjs"],"names":["defaults","filter","level","levels","error","warn","debug","trace","noop","x","unique","v","i","a","indexOf","escapeRegExp","str","replace","escapeIfString","ExtendConsole","parent","prefix","Proxy","_levels","ownKeys","target","Object","keys","Reflect","getOwnPropertyDescriptor","key","value","enumerable","configurable","get","prop","set","createLogger","logMethods","console","_prefix","defineProperties","_filter","_level","name","fn","cb","result","undefined","getNearest","accumulatedPrefixes","unshift","Array","isArray","delimiter","prefixes","forEach","push","_delimiter","val","root","createProxy","extendedConsole","proxy","has","t","withinLevel","passesFilter","join","match","canBind","shouldPrint","formattedPrefixes","map","p","bind","Function","Consolite"],"mappings":"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","sourcesContent":["// todo delimiter\n\n/**\n * @callback Filter\n * @param {string[]} prefixes\n */\n\n/**\n * @typedef {Object} Logger\n * @prop {createLogger} create Creates new logger.\n * @prop {createLogger} createChild Creates a child logger. Prefix will be inherited. Level and levels will be inherited if undefined.\n * @prop {createLogger} createParent Creates a parent logger. Prefix will be inherited. Level and levels will be inherited if undefined.\n * @prop {Object.<string, number>} levels\n * @prop {number} level\n * @prop {Filter|string|RegExp} filter\n * @prop {Logger} root\n * @prop {Logger} parent\n */\n\nconst defaults = {\n  filter: '',\n  level: 3,\n  levels: {\n    default: 3,\n    error: 1,\n    warn: 2,\n    debug: 4,\n    trace: 4,\n  },\n}\n\nconst noop = x => x\nconst unique = (v, i, a) => a.indexOf(v) === i\n\n// $& means the whole matched string\nconst escapeRegExp = str => str.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')\nconst escapeIfString = str => (typeof str === 'string' ? escapeRegExp(str) : str)\n\nclass ExtendConsole {\n  _filter = null\n  _level = null\n  _levels = {}\n  _prefix = []\n  _delimiter = null\n  logMethods = /** @type {Console} */ ({})\n\n  constructor(parent, prefix) {\n    this.parent = parent\n    if (!parent) this.logMethods = console\n    this._prefix = prefix\n    Object.defineProperties(this, {\n      _filter: { enumerable: false },\n      _level: { enumerable: false },\n      _levels: { enumerable: false },\n      _prefix: { enumerable: false },\n    })\n  }\n\n  register(name, fn) {\n    this.logMethods[name] = fn\n  }\n\n  /**\n   * get prop from self or nearest ancestor\n   * @template T\n   * @param {(((T)=>{})|string|symbol)} cb\n   */\n  getNearest(cb) {\n    const fn = typeof cb === 'string' || typeof cb === 'symbol' ? x => x[cb] : cb\n    const result = fn(this)\n    return result !== null && result !== undefined\n      ? result\n      : this.parent && this.parent.getNearest(fn)\n  }\n\n  get prefix() {\n    let parent = this\n    const accumulatedPrefixes = [...this._prefix]\n    while ((parent = parent.parent)) accumulatedPrefixes.unshift(...parent._prefix)\n    return accumulatedPrefixes\n  }\n\n  get formattedPrefixes() {\n    if (!this.delimiter) return this.prefix\n    else {\n      const prefixes = []\n      this.prefix.forEach(prefix => prefixes.push(prefix, this.delimiter))\n      return prefixes\n    }\n  }\n\n  get delimiter() {\n    return this.getNearest('_delimiter')\n  }\n\n  set delimiter(value) {\n    this._delimiter = value\n  }\n\n  set prefix(value) {\n    this._prefix = Array.isArray(value) ? value : [value]\n  }\n\n  get level() {\n    return this.getNearest('_level') ?? defaults.level\n  }\n  set level(val) {\n    this._level = val\n  }\n  get filter() {\n    return this.getNearest('_filter') ?? defaults.filter\n  }\n  set filter(val) {\n    this._filter = val\n  }\n  get __self() {\n    // logger = proxied object, logger.__self = original object\n    return this\n  }\n  get root() {\n    return this.parent?.root || this\n  }\n\n  levels = new Proxy(this._levels, {\n    // todo could be cleaner. Might not need proxy\n    ownKeys: target =>\n      [\n        ...Object.keys(defaults.levels),\n        ...Object.keys(this.parent?.levels || {}),\n        ...Reflect.ownKeys(target),\n      ].filter(unique),\n    getOwnPropertyDescriptor: (target, key) => ({\n      value: target[key],\n      enumerable: true,\n      configurable: true,\n    }),\n    get: (target, prop) =>\n      target[prop] ||\n      target.default ||\n      this.parent?.levels[prop] ||\n      this.parent?.levels.default ||\n      defaults.levels[prop] ||\n      defaults.levels.default,\n    set: (target, prop, value) => (target[prop] = value),\n  })\n\n  createChild(...prefix) {\n    return createProxy(this, prefix)\n  }\n\n  create = createLogger\n}\n\n/**\n *\n * @param {ExtendConsole} parent\n * @param {(string|PrefixFn)[]} prefix\n * @returns {ConsoliteLogger}\n */\nexport const createProxy = (parent, prefix) => {\n  const extendedConsole = new ExtendConsole(parent, prefix)\n  const proxy = /** @type {ConsoliteLogger} */ (\n    new Proxy(extendedConsole, {\n      get(target, prop) {\n        if (Reflect.has(target, prop)) return Reflect.get(target, prop)\n\n        const fn = target.getNearest(t => t.logMethods[prop])\n\n        if (fn) {\n          const withinLevel = prop => target.levels[prop] <= target.level\n          const passesFilter = () =>\n            typeof target.filter === 'function'\n              ? target.filter(target.prefix)\n              : target.prefix.join('').match(escapeIfString(target.filter))\n\n          const canBind = typeof fn === 'function'\n          const shouldPrint = withinLevel(prop) && passesFilter() && canBind\n          const prefixes = target.formattedPrefixes.map(p => (typeof p === 'string' ? p : p(prop)))\n\n          return shouldPrint ? fn.bind(console, ...prefixes) : noop\n        }\n      },\n      set(target, prop, value) {\n        if (Reflect.has(target, prop)) target[prop] = value\n        else if (value instanceof Function) target.logMethods[prop] = value\n        else return false\n        return true\n      },\n      ownKeys(target) {\n        const keys = [...Reflect.ownKeys(target), ...Reflect.ownKeys(target.logMethods)]\n        let parent = target\n        while ((parent = parent.parent)) keys.push(...Reflect.ownKeys(parent.logMethods))\n        return keys\n      },\n      getOwnPropertyDescriptor(target, prop) {\n        if (Reflect.get(target, prop))\n          return Object.getOwnPropertyDescriptor(target, prop)\n\n        return (\n          parent.getNearest(t => Object.getOwnPropertyDescriptor(t.logMethods, prop)) ||\n          undefined\n        )\n      },\n    })\n  )\n  return proxy\n}\n\n/**\n * @callback PrefixFn\n * @param {string|symbol} method console method, eg. log, debug etc...\n */\n\n/** @typedef {ExtendConsole & Console} ConsoliteLogger */\n\n/**\n * @param {(string|PrefixFn)[]} prefix\n * @returns {ConsoliteLogger}\n */\nexport const createLogger = (...prefix) => {\n  return createProxy(null, prefix)\n}\n\n/** @type {ConsoliteLogger} */\nexport class Consolite {\n  constructor(...prefix) {\n    return createLogger(...prefix)\n  }\n}\n"],"file":"index.js"}