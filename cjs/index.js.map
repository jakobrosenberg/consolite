{"version":3,"sources":["../esm/index.mjs"],"names":["defaults","filter","level","levels","error","warn","debug","trace","noop","x","unique","v","i","a","indexOf","escapeRegExp","str","replace","escapeIfString","ExtendConsole","parent","prefix","Proxy","_levels","ownKeys","target","Object","keys","Reflect","getOwnPropertyDescriptor","key","value","enumerable","configurable","get","prop","set","createLogger","logMethods","console","_prefix","defineProperties","_filter","_level","name","fn","accumulatedPrefixes","unshift","Array","isArray","val","root","createProxy","extendedConsole","proxy","has","fnContext","withinLevel","passesFilter","join","match","canBind","shouldPrint","prefixes","map","p","bind","Function","push","Consolite"],"mappings":"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","sourcesContent":["/**\n * @callback Filter\n * @param {string[]} prefixes\n */\n\n/**\n * @typedef {Object} Logger\n * @prop {createLogger} create Creates new logger.\n * @prop {createLogger} createChild Creates a child logger. Prefix will be inherited. Level and levels will be inherited if undefined.\n * @prop {createLogger} createParent Creates a parent logger. Prefix will be inherited. Level and levels will be inherited if undefined.\n * @prop {Object.<string, number>} levels\n * @prop {number} level\n * @prop {Filter|string|RegExp} filter\n * @prop {Logger} root\n * @prop {Logger} parent\n */\n\nconst defaults = {\n  filter: '',\n  level: 3,\n  levels: {\n    default: 3,\n    error: 1,\n    warn: 2,\n    debug: 4,\n    trace: 4,\n  },\n}\n\nconst noop = x => x\nconst unique = (v, i, a) => a.indexOf(v) === i\n\n// $& means the whole matched string\nconst escapeRegExp = str => str.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')\nconst escapeIfString = str => (typeof str === 'string' ? escapeRegExp(str) : str)\n\nclass ExtendConsole {\n  _filter = null\n  _level = null\n  _levels = {}\n  _prefix = []\n  logMethods = /** @type {Console} */ ({})\n\n  constructor(parent, prefix) {\n    this.parent = parent\n    if (!parent) this.logMethods = console\n    this._prefix = prefix\n    Object.defineProperties(this, {\n      _filter: { enumerable: false },\n      _level: { enumerable: false },\n      _levels: { enumerable: false },\n      _prefix: { enumerable: false },\n    })\n  }\n\n  register(name, fn) {\n    this.logMethods[name] = fn\n  }\n\n  get prefix() {\n    let parent = this\n    const accumulatedPrefixes = [...this._prefix]\n    while ((parent = parent.parent)) accumulatedPrefixes.unshift(...parent._prefix)\n    return accumulatedPrefixes\n  }\n\n  set prefix(value) {\n    this._prefix = Array.isArray(value) ? value : [value]\n  }\n\n  get level() {\n    return this._level ?? this.parent?.level ?? defaults.level\n  }\n  set level(val) {\n    this._level = val\n  }\n  get filter() {\n    return this._filter ?? this.parent?.filter ?? defaults.filter\n  }\n  set filter(val) {\n    this._filter = val\n  }\n  get __self() {\n    // logger = proxied object, logger.__self = original object\n    return this\n  }\n  get root() {\n    return this.parent?.root || this\n  }\n\n  levels = new Proxy(this._levels, {\n    ownKeys: target =>\n      [\n        ...Object.keys(defaults.levels),\n        ...Object.keys(this.parent?.levels || {}),\n        ...Reflect.ownKeys(target),\n      ].filter(unique),\n    getOwnPropertyDescriptor: (target, key) => ({\n      value: target[key],\n      enumerable: true,\n      configurable: true,\n    }),\n    get: (target, prop) =>\n      target[prop] ||\n      target.default ||\n      this.parent?.levels[prop] ||\n      this.parent?.levels.default ||\n      defaults.levels[prop] ||\n      defaults.levels.default,\n    set: (target, prop, value) => (target[prop] = value),\n  })\n\n  createChild(...prefix) {\n    return createProxy(this, prefix)\n  }\n\n  create = createLogger\n}\n\n/**\n *\n * @param {ExtendConsole} parent\n * @param {(string|PrefixFn)[]} prefix\n * @returns {ConsoliteLogger}\n */\nexport const createProxy = (parent, prefix) => {\n  const extendedConsole = new ExtendConsole(parent, prefix)\n  const proxy = /** @type {ConsoliteLogger} */ (\n    new Proxy(extendedConsole, {\n      get(target, prop) {\n        if (Reflect.has(target, prop)) return Reflect.get(target, prop)\n\n        let fnContext = target\n        let fn = target.logMethods[prop]\n        while (!fn && fnContext) {\n          fnContext = fnContext.parent\n          fn = fnContext?.logMethods[prop]\n        }\n\n        if (fn) {\n          const withinLevel = prop => target.levels[prop] <= target.level\n          const passesFilter = () =>\n            typeof target.filter === 'function'\n              ? target.filter(target.prefix)\n              : target.prefix.join('').match(escapeIfString(target.filter))\n\n          const canBind = typeof fn === 'function'\n          const shouldPrint = withinLevel(prop) && passesFilter() && canBind\n          const prefixes = target.prefix.map(p => (typeof p === 'string' ? p : p(prop)))\n\n          return shouldPrint ? fn.bind(console, ...prefixes) : noop\n        }\n      },\n      set(target, prop, value) {\n        if (Reflect.has(target, prop)) target[prop] = value\n        else if (value instanceof Function) target.logMethods[prop] = value\n        else return false\n        return true\n      },\n      ownKeys(target) {\n        const keys = [...Reflect.ownKeys(target), ...Reflect.ownKeys(target.logMethods)]\n        let parent = target\n        while ((parent = parent.parent)) keys.push(...Reflect.ownKeys(parent.logMethods))\n        return keys\n      },\n      getOwnPropertyDescriptor(target, prop) {\n        if (Reflect.get(target, prop))\n          return Object.getOwnPropertyDescriptor(target, prop)\n\n        let parent = target\n        while (parent) {\n          if (Reflect.get(parent.logMethods, prop))\n            return Object.getOwnPropertyDescriptor(parent.logMethods, prop)\n          parent = parent.parent\n        }\n      },\n    })\n  )\n  return proxy\n}\n\n/**\n * @callback PrefixFn\n * @param {string|symbol} method console method, eg. log, debug etc...\n */\n\n/** @typedef {ExtendConsole & Console} ConsoliteLogger */\n\n/**\n * @param {(string|PrefixFn)[]} prefix\n * @returns {ConsoliteLogger}\n */\nexport const createLogger = (...prefix) => {\n  return createProxy(null, prefix)\n}\n\n/** @type {ConsoliteLogger} */\nexport class Consolite {\n  constructor(...prefix) {\n    return createLogger(...prefix)\n  }\n}\n"],"file":"index.js"}